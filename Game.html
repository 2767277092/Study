<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>中华趣味答题游戏（改良版）</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Microsoft YaHei", sans-serif;
    }

    body {
      background-color: #f5f8ff;
      color: #333;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
      padding: 30px;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
    }

    .header h1 {
      color: #2c5282;
      margin-bottom: 15px;
    }

    .difficulty-select {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 10px;
    }

    .difficulty-btn {
      padding: 8px 20px;
      border: none;
      border-radius: 20px;
      background-color: #e2e8f0;
      color: #4a5568;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .difficulty-btn.active {
      background-color: #2c5282;
      color: #fff;
      font-weight: bold;
    }

    .tab-nav {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 30px;
    }

    .tab-btn {
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      background-color: #e2e8f0;
      color: #4a5568;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 16px;
    }

    .tab-btn.active {
      background-color: #3182ce;
      color: #fff;
      font-weight: bold;
    }

    .game-panel {
      display: none;
      animation: fadeIn 0.5s ease;
    }

    .game-panel.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .question-info {
      margin-bottom: 25px;
      text-align: center;
    }

    .question-progress {
      font-size: 14px;
      color: #718096;
      margin-bottom: 10px;
    }

    .score-info {
      font-size: 16px;
      color: #2c5282;
      font-weight: 500;
      margin-bottom: 15px;
    }

    .hint-container {
      background-color: #f7fafc;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      min-height: 80px;
      border: 1px solid #e2e8f0;
    }

    .hint-title {
      font-size: 14px;
      color: #718096;
      margin-bottom: 10px;
      text-align: left;
    }

    .hint-content {
      font-size: 18px;
      color: #2d3748;
      line-height: 1.6;
      text-align: left;
    }

    /* 按钮组：回上一题 + 更多提示 */
    .btn-group {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 0 auto 25px;
      flex-wrap: wrap;
    }

    .prev-question-btn {
      padding: 10px 25px;
      border: none;
      border-radius: 8px;
      background-color: #2b6cb0;
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .prev-question-btn:disabled {
      background-color: #a0aec0;
      cursor: not-allowed;
    }

    .hint-more-btn {
      padding: 10px 25px;
      border: none;
      border-radius: 8px;
      background-color: #38a169;
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .hint-more-btn:disabled {
      background-color: #a7f3d0;
      cursor: not-allowed;
    }

    .options-container {
      display: grid;
      gap: 15px;
      margin-bottom: 30px;
    }

    .options-province,
    .options-idiom {
      grid-template-columns: repeat(2, 1fr);
      /* 8个选项 → 2列4行 */
    }

    .options-riddle {
      grid-template-columns: repeat(1, 1fr);
      /* 4个选项 → 1列4行 */
    }

    .option-btn {
      padding: 18px 10px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      background-color: #fff;
      color: #2d3748;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 16px;
      text-align: center;
    }

    .option-btn:hover:not(:disabled) {
      border-color: #3182ce;
      background-color: #ebf8ff;
    }

    .option-btn.correct {
      background-color: #c6f6d5;
      border-color: #38a169;
      color: #22543d;
      font-weight: bold;
    }

    .option-btn.wrong {
      background-color: #fed7d7;
      border-color: #e53e3e;
      color: #742a2a;
    }

    .reset-game-btn {
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      background-color: #e53e3e;
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 16px;
      margin: 0 auto;
      display: block;
    }

    .reset-game-btn:hover {
      background-color: #c53030;
    }

    .game-result {
      text-align: center;
      padding: 30px;
      display: none;
      animation: fadeIn 0.5s ease;
    }

    .game-result.active {
      display: block;
    }

    .result-title {
      font-size: 24px;
      color: #2c5282;
      margin-bottom: 20px;
    }

    .result-score {
      font-size: 20px;
      margin-bottom: 15px;
      color: #3182ce;
    }

    .result-desc {
      font-size: 16px;
      color: #718096;
      margin-bottom: 25px;
    }

    /* 响应式适配 */
    @media (max-width: 768px) {

      .options-province,
      .options-idiom {
        grid-template-columns: repeat(1, 1fr);
      }

      .tab-nav {
        flex-wrap: wrap;
      }

      .tab-btn {
        padding: 10px 20px;
        font-size: 14px;
      }

      .btn-group {
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- 头部：标题+难度选择 -->
    <div class="header">
      <h1>中华趣味答题游戏（改良版）</h1>
      <div class="difficulty-select">
        <button class="difficulty-btn active" data-score="0.5">简单 (得分系数0.5)</button>
        <button class="difficulty-btn" data-score="0.2">适中 (得分系数0.2)</button>
        <button class="difficulty-btn" data-score="0.1">困难 (得分系数0.1)</button>
      </div>
      <p>难度波动±0.1 | 每个板块40道题 | 题目不可重复 | 同答案不同提示算不同题</p>
    </div>

    <!-- 标签页导航 -->
    <div class="tab-nav">
      <button class="tab-btn active" data-panel="province">猜省份</button>
      <button class="tab-btn" data-panel="idiom">猜成语</button>
      <button class="tab-btn" data-panel="riddle">猜灯谜</button>
    </div>

    <!-- 猜省份板块 -->
    <div class="game-panel active" id="province">
      <div class="question-info">
        <div class="question-progress">当前进度：<span id="province-progress">1/40</span></div>
        <div class="score-info">当前得分：<span id="province-score">0</span></div>
      </div>
      <div class="hint-container">
        <div class="hint-title">提示（当前显示第<span id="province-hint-count">1</span>/5条）：</div>
        <div class="hint-content" id="province-hint"></div>
      </div>
      <div class="btn-group">
        <button class="prev-question-btn" id="province-prev" disabled>回上一题</button>
        <button class="hint-more-btn" id="province-hint-more">获取更多提示</button>
      </div>
      <div class="options-container options-province" id="province-options"></div>
      <div class="game-result" id="province-result">
        <h2 class="result-title">答题完成！</h2>
        <div class="result-score">总得分：<span id="province-total-score">0</span></div>
        <div class="result-desc">恭喜你完成了40道猜省份题目，再接再厉！</div>
        <button class="reset-game-btn" id="province-reset">重新开始</button>
      </div>
    </div>

    <!-- 猜成语板块 -->
    <div class="game-panel" id="idiom">
      <div class="question-info">
        <div class="question-progress">当前进度：<span id="idiom-progress">1/40</span></div>
        <div class="score-info">当前得分：<span id="idiom-score">0</span></div>
      </div>
      <div class="hint-container">
        <div class="hint-title">提示（当前显示第<span id="idiom-hint-count">1</span>/5条）：</div>
        <div class="hint-content" id="idiom-hint"></div>
      </div>
      <div class="btn-group">
        <button class="prev-question-btn" id="idiom-prev" disabled>回上一题</button>
        <button class="hint-more-btn" id="idiom-hint-more">获取更多提示</button>
      </div>
      <div class="options-container options-idiom" id="idiom-options"></div>
      <div class="game-result" id="idiom-result">
        <h2 class="result-title">答题完成！</h2>
        <div class="result-score">总得分：<span id="idiom-total-score">0</span></div>
        <div class="result-desc">恭喜你完成了40道猜成语题目，再接再厉！</div>
        <button class="reset-game-btn" id="idiom-reset">重新开始</button>
      </div>
    </div>

    <!-- 猜灯谜板块 -->
    <div class="game-panel" id="riddle">
      <div class="question-info">
        <div class="question-progress">当前进度：<span id="riddle-progress">1/40</span></div>
        <div class="score-info">当前得分：<span id="riddle-score">0</span></div>
      </div>
      <div class="hint-container">
        <div class="hint-title">灯谜提示：</div>
        <div class="hint-content" id="riddle-hint"></div>
      </div>
      <div class="btn-group">
        <button class="prev-question-btn" id="riddle-prev" disabled>回上一题</button>
      </div>
      <div class="options-container options-riddle" id="riddle-options"></div>
      <div class="game-result" id="riddle-result">
        <h2 class="result-title">答题完成！</h2>
        <div class="result-score">总得分：<span id="riddle-total-score">0</span></div>
        <div class="result-desc">恭喜你完成了40道猜灯谜题目，再接再厉！</div>
        <button class="reset-game-btn" id="riddle-reset">重新开始</button>
      </div>
    </div>
  </div>

  <script>
    // 全局配置
    const GAME_CONFIG = {
      totalQuestions: 40, // 每次答题数量
      hintCount: 5, // 省份/成语提示数量
      provinceOptionCount: 8, // 省份/成语选项数量
      riddleOptionCount: 4, // 灯谜选项数量
      difficultyFluctuation: 0.1, // 难度波动值
      baseScorePerQuestion: 10 // 每道题基础分值
    };

    // --------------- 扩展题库（同答案多组提示，提示区别大，可扩展至100道/板块）---------------
    // 猜省份题库（格式：{answer: 省份名, hintsGroup: [[提示组1], [提示组2], ...] 每组5条提示，区别较大}）
    const PROVINCE_BANK = [
      {
        answer: "江苏省",
        hintsGroup: [
          [
            "位于中国东部沿海地区",
            "地处长江下游，濒临黄海",
            "境内水网密布，有“鱼米之乡”的美誉",
            "省会城市是南京，有“六朝古都”之称",
            "以精致园林景观闻名，著名景点有拙政园、留园"
          ],
          [
            "中国经济强省之一，民营经济活跃",
            "境内有太湖，是中国五大淡水湖之一",
            "方言属于吴语和江淮官话片区",
            "特色美食有盐水鸭、大闸蟹、松鼠鳜鱼",
            "苏州评弹、昆曲是当地代表性传统文化艺术"
          ]
        ]
      },
      {
        answer: "浙江省",
        hintsGroup: [
          [
            "位于中国东南沿海",
            "毗邻福建省和江苏省，境内多山地丘陵",
            "海岸线漫长，渔业资源丰富",
            "省会是杭州，拥有著名的西湖景区",
            "民营经济发达，义乌小商品市场享誉全国"
          ],
          [
            "境内有钱塘江，每年有壮观的钱塘江大潮",
            "茶叶产量丰富，西湖龙井、安吉白茶享誉世界",
            "宁波港是中国重要的深水良港之一",
            "特色美食有西湖醋鱼、东坡肉、嘉兴粽子",
            "乌镇、西塘是典型的江南水乡古镇代表"
          ]
        ]
      },
      {
        answer: "广东省",
        hintsGroup: [
          [
            "位于中国南部沿海",
            "濒临南海，与香港、澳门相邻",
            "气候温暖湿润，属于亚热带季风气候",
            "省会是广州，有“羊城”的别称",
            "经济总量连续多年位居全国首位，深圳是其副省级市"
          ],
          [
            "粤菜是中国八大菜系之一，口味清淡鲜美",
            "境内有珠江，是中国南方最大的河流",
            "潮汕文化、客家文化在这里交融并存",
            "珠海长隆、广州塔是著名的旅游地标",
            "电子信息产业发达，深圳华强北是电子数码集散地"
          ]
        ]
      },
      {
        answer: "四川省",
        hintsGroup: [
          [
            "位于中国西南地区",
            "地形复杂，有盆地、高原、山地等多种地貌",
            "气候湿润，物产丰富，有“天府之国”的美誉",
            "省会是成都，以悠闲的生活节奏和美食闻名",
            "著名景点有九寨沟、峨眉山，特色美食有火锅、担担面"
          ],
          [
            "境内有长江三峡的西段，水力资源丰富",
            "川剧是当地特色戏曲，变脸技艺享誉中外",
            "大熊猫的主要栖息地，有卧龙大熊猫自然保护区",
            "特色小吃有钟水饺、龙抄手、夫妻肺片",
            "省会成都有“锦官城”之称，宽窄巷子是网红打卡地"
          ]
        ]
      },
      {
        answer: "山东省",
        hintsGroup: [
          [
            "位于中国华东地区，黄河下游",
            "濒临渤海和黄海，海岸线漫长",
            "是儒家文化的发源地，历史文化底蕴深厚",
            "省会是济南，有“泉城”的别称",
            "青岛啤酒享誉全国，泰山是其标志性名山"
          ],
          [
            "境内有孔子故里曲阜，孔庙、孔府、孔林闻名世界",
            "鲁菜是中国八大菜系之首，口味醇厚香浓",
            "烟台苹果、莱阳梨是全国知名的特色农产品",
            "青岛栈桥、蓬莱阁是著名的海滨旅游景点",
            "黄河在这里注入渤海，形成了广阔的黄河三角洲"
          ]
        ]
      },
      // 继续扩展至100道，保持相同格式即可
      {
        answer: "河南省",
        hintsGroup: [
          [
            "位于中国中部地区",
            "黄河穿境而过，是华夏文明的重要发祥地",
            "地形以平原为主，农业发达",
            "省会是郑州，是重要的交通枢纽",
            "洛阳、开封都是著名的古都，龙门石窟享誉世界"
          ],
          [
            "豫剧是中国最大的地方戏曲剧种之一",
            "信阳毛尖是中国十大名茶之一，口感鲜爽",
            "安阳殷墟是中国最早的文字甲骨文出土之地",
            "特色美食有胡辣汤、烩面、道口烧鸡",
            "嵩山少林寺是中国佛教禅宗祖庭，武术文化发源地"
          ]
        ]
      },
      {
        answer: "云南省",
        hintsGroup: [
          [
            "位于中国西南边陲",
            "与多个东南亚国家接壤，民族众多",
            "气候垂直差异明显，动植物资源丰富",
            "省会是昆明，有“春城”的美誉",
            "著名景点有丽江古城、石林，普洱茶是其特色产品"
          ],
          [
            "大理古城、洱海是网红旅游打卡地，风景秀丽",
            "过桥米线是当地标志性特色美食，风味独特",
            "西双版纳有中国最大的热带雨林自然保护区",
            "东巴文化是当地纳西族的独特传统文化，有东巴文字",
            "矿产资源丰富，被称为“有色金属王国”"
          ]
        ]
      },
      {
        answer: "陕西省",
        hintsGroup: [
          [
            "位于中国西北部",
            "黄河中游地区，地形以高原、山地为主",
            "是中华文明的重要发祥地之一",
            "省会是西安，有“十三朝古都”之称",
            "兵马俑、大雁塔是其标志性景点，肉夹馍是特色美食"
          ],
          [
            "陕北黄土高原是黄土高原的核心区域，窑洞是传统民居",
            "秦腔是当地特色戏曲，唱腔高亢激昂",
            "华山是中国五岳中的西岳，以险峻著称于世",
            "羊肉泡馍、凉皮是当地家喻户晓的特色小吃",
            "西安城墙是中国现存规模最大、保存最完整的古代城垣"
          ]
        ]
      },
      {
        answer: "河北省",
        hintsGroup: [
          [
            "位于中国华北地区",
            "环绕首都北京，毗邻天津直辖市",
            "地形多样，有平原、山地、高原",
            "省会是石家庄，交通便利",
            "承德避暑山庄、山海关是著名旅游景点"
          ],
          [
            "赵州桥是世界上现存最古老的石拱桥之一，历史悠久",
            "评剧是中国五大戏曲剧种之一，发源于唐山",
            "衡水老白干是中国知名的白酒品牌，香型独特",
            "坝上草原是著名的草原旅游胜地，夏季风景宜人",
            "邯郸是中国历史上沿用地名最久的城市之一，有三千多年历史"
          ]
        ]
      },
      {
        answer: "湖南省",
        hintsGroup: [
          [
            "位于中国中南部，长江中游地区",
            "境内有洞庭湖，湘江穿境而过",
            "气候湿润，植被覆盖率高",
            "省会是长沙，娱乐产业发达",
            "张家界国家森林公园、岳阳楼是著名景点，臭豆腐是特色美食"
          ],
          [
            "湘菜是中国八大菜系之一，口味鲜辣香浓，重油重色",
            "橘子洲头是长沙标志性景点，青年毛泽东雕像闻名全国",
            "凤凰古城是典型的湘西水乡古镇，民族风情浓郁",
            "君山银针是中国十大名茶之一，属于黄茶类",
            "韶山是毛泽东同志的故乡，是著名的红色旅游胜地"
          ]
        ]
      }
    ];

    // 猜成语题库（格式同省份，同答案多组提示，区别较大，不包含成语本身）
    const IDIOM_BANK = [
      {
        answer: "画龙点睛",
        hintsGroup: [
          [
            "这是一个褒义成语，与绘画相关",
            "原形容梁代画家张僧繇的绘画技艺高超",
            "比喻在关键地方加上精辟语句，使内容更加生动传神",
            "故事中，画家在龙的眼睛上点了一笔后，龙便腾空而去",
            "近义词有“点石成金”，反义词有“画蛇添足”"
          ],
          [
            "出自唐代张彦远的《历代名画记·张僧繇》",
            "属于典故类成语，有明确的历史人物和故事支撑",
            "常用来形容文章、讲话在关键处的精彩升华",
            "成语结构为动宾式，可作主语、谓语、定语",
            "现代使用中，也常用来形容影视、作品的收尾亮点"
          ]
        ]
      },
      {
        answer: "守株待兔",
        hintsGroup: [
          [
            "这是一个贬义成语，与农业生产相关",
            "出自《韩非子》，讲述了一个农夫的故事",
            "比喻心存侥幸，妄想不劳而获，坐等意外收获",
            "故事中，农夫偶然捡到一只撞死在树桩上的兔子",
            "此后农夫便不再劳作，天天守在树桩旁等待兔子再次出现"
          ],
          [
            "属于寓言类成语，带有鲜明的讽刺和警示意味",
            "出自《韩非子·五蠹》，是韩非用来阐述治国理念的典故",
            "成语结构为连动式，可作谓语、宾语、定语",
            "近义词有“坐享其成”“不劳而获”，反义词有“勤能补拙”",
            "现代常用来批评那些墨守成规、不愿主动进取的人"
          ]
        ]
      },
      {
        answer: "刻舟求剑",
        hintsGroup: [
          [
            "这是一个贬义成语，与水上出行相关",
            "出自《吕氏春秋》，讲述了一个楚国人的故事",
            "比喻办事刻板，拘泥而不知变通，不懂得根据实际情况调整方法",
            "故事中，楚人乘船时宝剑掉入水中，他在船舷上刻下记号",
            "等船靠岸后，便按照记号下水寻找宝剑，最终一无所获"
          ],
          [
            "属于寓言类成语，讽刺了那些思想僵化、墨守成规的人",
            "出自《吕氏春秋·察今》，用来阐述“与时俱进”的重要性",
            "成语结构为连动式，可作谓语、定语、状语",
            "近义词有“墨守成规”“固步自封”，反义词有“随机应变”",
            "现代常用来批评那些不懂得根据环境变化调整策略的行为"
          ]
        ]
      },
      {
        answer: "卧薪尝胆",
        hintsGroup: [
          [
            "这是一个褒义成语，与历史战争相关",
            "出自《史记》，讲述了一位诸侯王的故事",
            "比喻人刻苦自励，发愤图强，立志报仇雪耻",
            "故事的主人公是越王勾践，他被吴王夫差打败后沦为阶下囚",
            "他每日睡在柴草上，饭前尝苦胆，最终励精图治打败吴国"
          ],
          [
            "属于历史典故类成语，有明确的春秋时期历史背景",
            "出自《史记·越王勾践世家》，详细记载了勾践的复国历程",
            "成语结构为联合式，可作谓语、定语、状语",
            "近义词有“发愤图强”“励精图治”，反义词有“胸无大志”",
            "现代常用来鼓励人们在困境中不屈不挠、刻苦奋斗，实现目标"
          ]
        ]
      },
      {
        answer: "亡羊补牢",
        hintsGroup: [
          [
            "这是一个中性偏褒义成语，与畜牧业相关",
            "出自《战国策》，讲述了一个牧民的故事",
            "比喻出了问题以后想办法补救，可以防止继续受损失",
            "故事中，牧民的羊圈破了个洞，夜里羊被狼叼走了一只",
            "牧民起初不以为然，第二天又丢了羊，才赶紧修补羊圈"
          ],
          [
            "属于寓言类成语，带有明显的劝诫和教育意义",
            "出自《战国策·楚策四》，是庄辛用来劝谏楚襄王的典故",
            "成语结构为连动式，可作主语、谓语、宾语",
            "近义词有“知错就改”“悬崖勒马”，反义词有“执迷不悟”",
            "现代常用来鼓励人们在犯错后及时补救，避免更大的损失"
          ]
        ]
      },
      // 继续扩展至100道，保持相同格式即可
      {
        answer: "画蛇添足",
        hintsGroup: [
          [
            "这是一个贬义成语，与祭祀相关",
            "出自《战国策》，讲述了一群门客的故事",
            "比喻做了多余的事情，非但无益，反而不合适",
            "故事中，有人在画完蛇后，又额外给蛇画上了脚",
            "最终他失去了原本可以得到的酒"
          ],
          [
            "属于寓言类成语，讽刺了那些自作聪明、多此一举的人",
            "出自《战国策·齐策二》，是一个广为流传的民间典故",
            "成语结构为连动式，可作谓语、宾语、定语",
            "近义词有“多此一举”“弄巧成拙”，反义词有“恰到好处”",
            "现代常用来批评那些做了多余动作、反而坏了事的行为"
          ]
        ]
      },
      {
        answer: "塞翁失马",
        hintsGroup: [
          [
            "这是一个中性成语，与老人和马相关",
            "出自《淮南子》，讲述了一位边塞老人的故事",
            "比喻坏事在一定条件下可以变为好事，祸福相依",
            "故事中，老人的马走失了，众人惋惜，他却认为未必是坏事",
            "后来走失的马带回了一匹骏马，众人庆贺，他却认为未必是好事"
          ],
          [
            "属于寓言类成语，蕴含了朴素的辩证法思想",
            "出自《淮南子·人间训》，完整故事包含“福祸相依”的哲理",
            "成语结构为主谓式，可作宾语、定语，常与“焉知非福”连用",
            "近义词有“祸福相依”“因祸得福”，反义词有“福无双至”",
            "现代常用来安慰他人，说明困境中可能暗藏转机，不必过于悲观"
          ]
        ]
      },
      {
        answer: "狐假虎威",
        hintsGroup: [
          [
            "这是一个贬义成语，与动物相关",
            "出自《战国策》，讲述了狐狸和老虎的故事",
            "比喻依仗别人的势力欺压人，本身并没有什么本事",
            "故事中，狐狸被老虎抓住后，谎称自己是百兽之王",
            "它带着老虎在森林中行走，百兽见了都纷纷逃窜，老虎却信以为真"
          ],
          [
            "属于寓言类成语，讽刺了那些仗势欺人、外强中干的人",
            "出自《战国策·楚策一》，是江乙用来劝谏楚宣王的典故",
            "成语结构为主谓式，可作谓语、定语、状语",
            "近义词有“仗势欺人”“狗仗人势”，反义词有“独当一面”",
            "现代常用来批评那些依靠他人权势作威作福，自身无能力的人"
          ]
        ]
      },
      {
        answer: "井底之蛙",
        hintsGroup: [
          [
            "这是一个贬义成语，与动物和水井相关",
            "出自《庄子》，讲述了一只青蛙的故事",
            "比喻见识短浅，眼界狭窄，不知道外面的广阔世界",
            "故事中，青蛙一直生活在井底，认为天空只有井口那么大",
            "当它听到东海鳖讲述大海的广阔后，才自惭形秽"
          ],
          [
            "属于寓言类成语，讽刺了那些眼界狭隘、孤陋寡闻的人",
            "出自《庄子·秋水》，通过青蛙与东海鳖的对话阐述哲理",
            "成语结构为偏正式，可作主语、宾语、定语",
            "近义词有“孤陋寡闻”“鼠目寸光”，反义词有“见多识广”",
            "现代常用来批评那些缺乏见识、目光短浅，却妄自尊大的人"
          ]
        ]
      },
      {
        answer: "愚公移山",
        hintsGroup: [
          [
            "这是一个褒义成语，与老人和大山相关",
            "出自《列子》，讲述了一位老人的故事",
            "比喻坚持不懈地改造自然和坚定不移地进行斗争",
            "故事中，愚公家门口有两座大山挡路，他决心带领子孙挖平大山",
            "最终他的诚心感动了天帝，天帝派神仙将大山移走"
          ],
          [
            "属于神话寓言类成语，蕴含了“坚持不懈”的精神内核",
            "出自《列子·汤问》，展现了古代劳动人民的坚韧不拔和美好愿望",
            "成语结构为主谓式，可作主语、谓语、定语",
            "近义词有“坚持不懈”“持之以恒”，反义词有“半途而废”",
            "现代常用来鼓励人们树立远大目标，坚持不懈奋斗，终能实现理想"
          ]
        ]
      }
    ];

    // 猜灯谜题库（格式：{riddleGroup: [[灯谜1, 谜底, 干扰项], [灯谜2, 谜底, 干扰项], ...]} 同谜底不同灯谜，区别大）
    const RIDDLE_BANK = [
      {
        answer: "告",
        riddleGroup: [
          ["一口咬掉牛尾巴（打一字）", ["牛", "口", "尾"]],
          ["牛去尾巴留一口（打一字）", ["件", "叩", "休"]]
        ]
      },
      {
        answer: "重",
        riddleGroup: [
          ["千里相逢（打一字）", ["千", "里", "逢"]],
          ["千里一线牵（打一字）", ["仟", "俚", "迁"]]
        ]
      },
      {
        answer: "拿",
        riddleGroup: [
          ["一人一张口，口下长只手（打一字）", ["人", "口", "手"]],
          ["手托下巴（打一字）", ["扣", "拾", "拍"]]
        ]
      },
      {
        answer: "明",
        riddleGroup: [
          ["太阳西边下，月亮东边挂（打一字）", ["阳", "月", "挂"]],
          ["日月同辉（打一字）", ["昌", "晶", "朋"]]
        ]
      },
      {
        answer: "克",
        riddleGroup: [
          ["十个哥哥（打一字）", ["十", "哥", "兄"]],
          ["兄有十口（打一字）", ["吉", "吏", "品"]]
        ]
      },
      // 继续扩展至100道，保持相同格式即可
      {
        answer: "出",
        riddleGroup: [
          ["山上还有山（打一字）", ["山", "上", "有"]],
          ["两山叠在一起（打一字）", ["岳", "屾", "岗"]]
        ]
      },
      {
        answer: "斌",
        riddleGroup: [
          ["文武双全（打一字）", ["文", "武", "全"]],
          ["文韬武略集一身（打一字）", ["刘", "斌", "政"]]
        ]
      },
      {
        answer: "军",
        riddleGroup: [
          ["挥手告别（打一字）", ["挥", "手", "别"]],
          ["手离开军（打一字）", ["挥", "师", "旅"]]
        ]
      },
      {
        answer: "值",
        riddleGroup: [
          ["半真半假（打一字）", ["真", "假", "半"]],
          ["真假参半（打一字）", ["俱", "假", "真"]]
        ]
      }
    ];

    // --------------- 游戏核心逻辑（改良版）---------------
    // 全局状态管理
    let gameState = {
      currentPanel: "province",
      currentDifficulty: 0.5, // 改良：默认难度改为简单0.5
      panels: {
        province: {
          currentQuestion: 0,
          totalScore: 0,
          currentHintsShown: 1,
          currentQuestionData: null,
          questionList: [],
          questionHistory: [] // 新增：保存每一题的答题状态，用于回退
        },
        idiom: {
          currentQuestion: 0,
          totalScore: 0,
          currentHintsShown: 1,
          currentQuestionData: null,
          questionList: [],
          questionHistory: [] // 新增：保存每一题的答题状态，用于回退
        },
        riddle: {
          currentQuestion: 0,
          totalScore: 0,
          currentQuestionData: null,
          questionList: [],
          questionHistory: [] // 新增：保存每一题的答题状态，用于回退
        }
      }
    };

    // 初始化页面
    window.onload = function () {
      bindEventListeners();
      initPanel("province");
    };

    // 绑定所有事件监听
    function bindEventListeners() {
      // 难度选择事件（改良：切换难度刷新当前板块题目）
      document.querySelectorAll(".difficulty-btn").forEach(btn => {
        btn.addEventListener("click", function () {
          document.querySelectorAll(".difficulty-btn").forEach(b => b.classList.remove("active"));
          this.classList.add("active");
          gameState.currentDifficulty = parseFloat(this.dataset.score);
          // 刷新当前活跃板块的题目
          initPanel(gameState.currentPanel);
        });
      });

      // 板块切换事件（改良：切换板块刷新题目，不可重复）
      document.querySelectorAll(".tab-btn").forEach(btn => {
        btn.addEventListener("click", function () {
          const panelId = this.dataset.panel;
          document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
          document.querySelectorAll(".game-panel").forEach(p => p.classList.remove("active"));
          this.classList.add("active");
          document.getElementById(panelId).classList.add("active");
          gameState.currentPanel = panelId;
          // 重新初始化板块，生成全新不可重复题目
          initPanel(panelId);
        });
      });

      // 猜省份-获取更多提示
      document.getElementById("province-hint-more").addEventListener("click", function () {
        updateHint("province");
      });

      // 猜成语-获取更多提示
      document.getElementById("idiom-hint-more").addEventListener("click", function () {
        updateHint("idiom");
      });

      // 新增：回上一题事件（三个板块）
      document.getElementById("province-prev").addEventListener("click", () => prevQuestion("province"));
      document.getElementById("idiom-prev").addEventListener("click", () => prevQuestion("idiom"));
      document.getElementById("riddle-prev").addEventListener("click", () => prevQuestion("riddle"));

      // 重新开始按钮事件
      document.getElementById("province-reset").addEventListener("click", () => initPanel("province"));
      document.getElementById("idiom-reset").addEventListener("click", () => initPanel("idiom"));
      document.getElementById("riddle-reset").addEventListener("click", () => initPanel("riddle"));
    }

    // 初始化指定板块（改良：切换/难度调整时刷新，生成不可重复题目）
    function initPanel(panelId) {
      const panelState = gameState.panels[panelId];
      // 完全重置板块状态
      panelState.currentQuestion = 0;
      panelState.totalScore = 0;
      panelState.currentHintsShown = 1;
      panelState.currentQuestionData = null;
      panelState.questionHistory = [];
      // 生成不可重复的40道题目列表
      panelState.questionList = generateUniqueQuestionList(panelId);

      // 隐藏结果面板，更新进度和得分
      document.getElementById(`${panelId}-result`).classList.remove("active");
      document.getElementById(`${panelId}-progress`).textContent = `1/${GAME_CONFIG.totalQuestions}`;
      document.getElementById(`${panelId}-score`).textContent = "0";
      // 禁用回上一题按钮（第一题）
      document.getElementById(`${panelId}-prev`).disabled = true;

      // 加载第一道题
      loadQuestion(panelId);
    }

    // 改良：生成指定板块的40道不可重复题目列表（同答案不同提示算不同题，提示区别大）
    function generateUniqueQuestionList(panelId) {
      const questionList = [];
      let extendedBank = [];

      // 第一步：构建扩展题库（将同答案的多组提示拆分为独立题目，确保提示区别大）
      if (panelId === "province") {
        PROVINCE_BANK.forEach(province => {
          province.hintsGroup.forEach(hints => {
            extendedBank.push({ answer: province.answer, hints: hints });
          });
        });
      } else if (panelId === "idiom") {
        IDIOM_BANK.forEach(idiom => {
          idiom.hintsGroup.forEach(hints => {
            extendedBank.push({ answer: idiom.answer, hints: hints });
          });
        });
      } else if (panelId === "riddle") {
        RIDDLE_BANK.forEach(riddle => {
          riddle.riddleGroup.forEach(([riddleContent, distractors]) => {
            extendedBank.push({ riddle: riddleContent, answer: riddle.answer, distractors: distractors });
          });
        });
      }

      // 第二步：随机抽取40道不可重复的题目（洗牌算法+截取）
      const shuffledBank = [...extendedBank].sort(() => Math.random() - 0.5);
      // 若扩展题库不足40道，重复补充（保持不可重复，优先用现有）
      while (questionList.length < GAME_CONFIG.totalQuestions) {
        const remaining = GAME_CONFIG.totalQuestions - questionList.length;
        const extract = shuffledBank.slice(0, remaining);
        questionList.push(...extract);
      }

      return questionList.slice(0, GAME_CONFIG.totalQuestions);
    }

    // 加载指定板块的当前题目
    function loadQuestion(panelId) {
      const panelState = gameState.panels[panelId];
      const currentQIndex = panelState.currentQuestion;

      // 判断是否完成所有题目
      if (currentQIndex >= GAME_CONFIG.totalQuestions) {
        showResult(panelId);
        return;
      }

      // 重置提示按钮状态
      if (panelId === "province" || panelId === "idiom") {
        document.getElementById(`${panelId}-hint-more`).disabled = false;
        panelState.currentHintsShown = 1;
        document.getElementById(`${panelId}-hint-count`).textContent = "1";
      }

      // 获取当前题目数据
      const questionData = panelState.questionList[currentQIndex];
      panelState.currentQuestionData = questionData;

      // 不同板块的加载逻辑
      if (panelId === "province" || panelId === "idiom") {
        loadProvinceOrIdiomQuestion(panelId, questionData);
      } else if (panelId === "riddle") {
        loadRiddleQuestion(panelId, questionData);
      }
    }

    // 加载猜省份/猜成语题目
    function loadProvinceOrIdiomQuestion(panelId, questionData) {
      const panelState = gameState.panels[panelId];
      const bank = panelId === "province" ? PROVINCE_BANK : IDIOM_BANK;

      // 更新初始提示（第一条）
      document.getElementById(`${panelId}-hint`).textContent = questionData.hints[0];

      // 生成选项（1正确+7错误，随机排序，避免重复）
      const options = [];
      const correctAnswer = questionData.answer;
      options.push({ text: correctAnswer, isCorrect: true });

      // 收集错误选项（避免重复，不包含正确答案）
      const distractorSet = new Set();
      while (distractorSet.size < GAME_CONFIG.provinceOptionCount - 1) {
        const randomIndex = Math.floor(Math.random() * bank.length);
        const distractor = bank[randomIndex].answer;
        if (distractor !== correctAnswer) {
          distractorSet.add(distractor);
        }
      }

      // 添加错误选项
      distractorSet.forEach(distractor => {
        options.push({ text: distractor, isCorrect: false });
      });

      // 随机排序选项
      options.sort(() => Math.random() - 0.5);

      // 渲染选项
      const optionsContainer = document.getElementById(`${panelId}-options`);
      optionsContainer.innerHTML = "";
      options.forEach(option => {
        const btn = document.createElement("button");
        btn.className = "option-btn";
        btn.textContent = option.text;
        btn.dataset.correct = option.isCorrect;
        btn.addEventListener("click", function () {
          checkAnswer(panelId, this);
        });
        optionsContainer.appendChild(btn);
      });
    }

    // 加载猜灯谜题目
    function loadRiddleQuestion(panelId, questionData) {
      // 更新灯谜提示
      document.getElementById(`${panelId}-hint`).textContent = questionData.riddle;

      // 生成选项（1正确+3错误，随机排序）
      const options = [];
      options.push({ text: questionData.answer, isCorrect: true });
      questionData.distractors.forEach(distractor => {
        options.push({ text: distractor, isCorrect: false });
      });

      // 随机排序选项
      options.sort(() => Math.random() - 0.5);

      // 渲染选项
      const optionsContainer = document.getElementById(`${panelId}-options`);
      optionsContainer.innerHTML = "";
      options.forEach(option => {
        const btn = document.createElement("button");
        btn.className = "option-btn";
        btn.textContent = option.text;
        btn.dataset.correct = option.isCorrect;
        btn.addEventListener("click", function () {
          checkAnswer(panelId, this);
        });
        optionsContainer.appendChild(btn);
      });
    }

    // 更新省份/成语的提示（显示更多）
    function updateHint(panelId) {
      const panelState = gameState.panels[panelId];
      const currentHintsShown = panelState.currentHintsShown;

      // 判断是否已显示所有提示
      if (currentHintsShown >= GAME_CONFIG.hintCount) {
        document.getElementById(`${panelId}-hint-more`).disabled = true;
        return;
      }

      // 更新显示的提示数量
      panelState.currentHintsShown = currentHintsShown + 1;
      document.getElementById(`${panelId}-hint-count`).textContent = panelState.currentHintsShown;

      // 更新提示内容（拼接已显示的所有提示，换行分隔）
      const questionData = panelState.currentQuestionData;
      let hintText = "";
      for (let i = 0; i < panelState.currentHintsShown; i++) {
        hintText += `${i + 1}. ${questionData.hints[i]}\n`;
      }
      document.getElementById(`${panelId}-hint`).textContent = hintText.trim();

      // 若显示完所有提示，禁用按钮
      if (panelState.currentHintsShown >= GAME_CONFIG.hintCount) {
        document.getElementById(`${panelId}-hint-more`).disabled = true;
      }
    }

    // 检查答题结果（改良：保存答题状态到历史记录，用于回退）
    function checkAnswer(panelId, optionBtn) {
      const panelState = gameState.panels[panelId];
      const isCorrect = optionBtn.dataset.correct === "true";
      const allOptions = document.querySelectorAll(`#${panelId}-options .option-btn`);
      const currentQIndex = panelState.currentQuestion;

      // 禁用所有选项，标记对错
      allOptions.forEach(btn => {
        btn.disabled = true;
        if (btn.dataset.correct === "true") {
          btn.classList.add("correct");
        } else if (btn === optionBtn && !isCorrect) {
          btn.classList.add("wrong");
        }
      });

      // 计算得分（改良：新得分系数 0.5/0.2/0.1，波动±0.1，最低为0）
      const difficultyFluctuation = (Math.random() * 2 - 1) * GAME_CONFIG.difficultyFluctuation;
      const actualScoreCoefficient = Math.max(0, gameState.currentDifficulty + difficultyFluctuation);
      const questionScore = Math.round(GAME_CONFIG.baseScorePerQuestion * actualScoreCoefficient);

      // 更新总分
      let questionTotalScore = panelState.totalScore;
      if (isCorrect) {
        questionTotalScore = panelState.totalScore + questionScore;
        panelState.totalScore = questionTotalScore;
        document.getElementById(`${panelId}-score`).textContent = panelState.totalScore;
      }

      // 新增：保存当前题的答题状态到历史记录（用于回退还原）
      panelState.questionHistory[currentQIndex] = {
        questionData: panelState.currentQuestionData,
        currentHintsShown: panelState.currentHintsShown,
        isCorrect: isCorrect,
        questionScore: questionScore,
        totalScore: questionTotalScore,
        optionsHtml: document.getElementById(`${panelId}-options`).innerHTML
      };

      // 延迟加载下一题（提升体验）
      setTimeout(() => {
        // 启用回上一题按钮（非第一题）
        panelState.currentQuestion += 1;
        document.getElementById(`${panelId}-prev`).disabled = false;
        // 更新进度
        document.getElementById(`${panelId}-progress`).textContent = `${panelState.currentQuestion + 1}/${GAME_CONFIG.totalQuestions}`;
        // 加载下一题
        loadQuestion(panelId);
      }, 1500);
    }

    // 新增：回看上一题核心逻辑（还原答题状态、提示、选项、得分）
    function prevQuestion(panelId) {
      const panelState = gameState.panels[panelId];
      const currentQIndex = panelState.currentQuestion;

      // 不能回退到负数索引
      if (currentQIndex <= 0) {
        document.getElementById(`${panelId}-prev`).disabled = true;
        return;
      }

      // 回退到上一题索引
      panelState.currentQuestion = currentQIndex - 1;
      const prevQIndex = panelState.currentQuestion;
      const prevQState = panelState.questionHistory[prevQIndex];

      // 若上一题无记录，直接加载
      if (!prevQState) {
        loadQuestion(panelId);
        return;
      }

      // 还原板块状态
      panelState.currentQuestionData = prevQState.questionData;
      panelState.currentHintsShown = prevQState.currentHintsShown;
      panelState.totalScore = prevQState.totalScore;

      // 还原UI显示
      // 1. 进度和得分
      document.getElementById(`${panelId}-progress`).textContent = `${prevQIndex + 1}/${GAME_CONFIG.totalQuestions}`;
      document.getElementById(`${panelId}-score`).textContent = prevQState.totalScore;
      // 2. 回退按钮状态（第一题禁用）
      document.getElementById(`${panelId}-prev`).disabled = prevQIndex === 0;
      // 3. 提示内容和数量
      if (panelId === "province" || panelId === "idiom") {
        document.getElementById(`${panelId}-hint-count`).textContent = prevQState.currentHintsShown;
        // 拼接已显示的提示
        let hintText = "";
        for (let i = 0; i < prevQState.currentHintsShown; i++) {
          hintText += `${i + 1}. ${prevQState.questionData.hints[i]}\n`;
        }
        document.getElementById(`${panelId}-hint`).textContent = hintText.trim();
        // 还原提示按钮状态
        document.getElementById(`${panelId}-hint-more`).disabled = prevQState.currentHintsShown >= GAME_CONFIG.hintCount;
      } else {
        document.getElementById(`${panelId}-hint`).textContent = prevQState.questionData.riddle;
      }
      // 4. 还原选项（包括对错标记、禁用状态）
      document.getElementById(`${panelId}-options`).innerHTML = prevQState.optionsHtml;

      // 还原选项按钮事件（避免点击失效）
      const allOptions = document.querySelectorAll(`#${panelId}-options .option-btn`);
      allOptions.forEach(btn => {
        btn.addEventListener("click", function () {
          checkAnswer(panelId, this);
        });
      });
    }

    // 显示答题结果
    function showResult(panelId) {
      const panelState = gameState.panels[panelId];
      // 更新总得分
      document.getElementById(`${panelId}-total-score`).textContent = panelState.totalScore;
      // 显示结果面板
      document.getElementById(`${panelId}-result`).classList.add("active");
    }
  </script>
</body>

</html>